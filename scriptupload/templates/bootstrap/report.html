{% extends 'bootstrap/base.html' %}
{% load static %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{report.name}}</h1>
    <div class="btn-toolbar">
        <form method="post" action="{% url 'delete_report' report.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger my-1">Delete&nbsp;<span class="align-text-bottom"
                    data-feather="file-minus"></span></button>
        </form>
    </div>
</div>
<div class="row mb-5">
    <div class="mt-3 col-12 col-md-6 col-sm-12">
        <h4>Scheduled emails</h4>
        All reports are sent at 12:00 PM UTC
        <div class="table-responsive">
            {% if scripts %}
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th scope="col">Email</th>
                        <th scope="col">Schedule</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in tasks %}
                    <tr>
                        <th scope="row">{{task.email}}</th>
                        <td>Every {{ days_of_week|get_item:task.day }}</td>
                        <td>
                            <form method="post" action="{% url 'delete_task' task.id %}">
                                {% csrf_token %}
                                <button class="text-danger text-decoration-none">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    <form method="post">
                        {% csrf_token %}

                        <tr>
                            <th><input type="text" placeholder="email@example.com" name="email"></th>
                            <th><select class="lead" name="day">
                                    <option value="1">Every Monday</option>
                                    <option value="2">Every Tuesday</option>
                                    <option value="3">Every Wednesday</option>
                                    <option value="4">Every Thursday</option>
                                    <option value="5">Every Friday</option>
                                    <option value="6">Every Saturday</option>
                                    <option value="7">Every Sunday</option>
                                    <option value="*">Every day</option>
                                </select></th>
                            <th><button class="text-decoration-none text-primary">Add</button></th>
                        </tr>
                    </form>
                </tbody>
            </table>
            {% else %}
            <span class="text-large">
                No scheduled tasks
            </span>
            {% endif %}
        </div>
    </div>
    <div class="mt-3 col-12 col-md-6 col-sm-12">
        <h4>Scripts in this report</h4>
        <ul>
            {% for script in report.scripts.all %}
            <li><a href="{% url 'script' script.name %}" class="text-decoration-none">{{script.name}}</a></li>
            {% endfor %}
        </ul>
    </div>
</div>
<div class="text-muted">
    <b>Created:</b> {{report.created}} &ensp; <b>Last run:</b> {{report.last_updated}}
</div>

{% endblock %}