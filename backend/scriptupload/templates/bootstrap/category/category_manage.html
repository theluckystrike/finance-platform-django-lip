{% extends 'bootstrap/base.html' %}
{% load static %}

{% block content %}
<script src="https://unpkg.com/htmx.org@1.9.10"
    integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC"
    crossorigin="anonymous"></script>
<script src="{% static 'bootstrap/path-params.js' %}"></script>
<style>
    .tree-container * {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .tree-container ul li {
        margin-left: 20px;
        position: relative;
        padding-left: 10px;
        line-height: 1.5;
        font-size: 20px;
        /* Adjust font size as needed */
    }

    .tree-container ul li::before {
        content: " ";
        position: absolute;
        width: 1px;
        background-color: #000;
        top: 5px;
        bottom: -15px;
        left: -15px;
    }

    .tree-container body>ul>li:first-child::before {
        top: 15px;
    }

    .tree-container ul li:not(:first-child):last-child::before {
        display: none;
    }

    .tree-container ul li:only-child::before {
        display: list-item;
        content: " ";
        position: absolute;
        width: 1px;
        background-color: #000;
        top: 5px;
        bottom: 10px;
        height: 10px;
        left: -15px;
    }

    .tree-container ul li::after {
        content: " ";
        position: absolute;
        left: -15px;
        width: 15px;
        height: 1px;
        background-color: #000;
        top: 15px;
    }
</style>
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
    <h1 class="h1"><a href="{% url 'uploadScript' %}"><span class="back-button"
                data-feather="arrow-left"></span></a>&nbsp;Category manager</h1>
</div>
<div class="tree-container d-flex justify-content-center">
    <div>
        <h1 class="h4 py-4 text-decoration-underline">Category Tree</h1>
        <ul>
            {% for category in categories %}
            <li><a class="category" data-category-id="{{category.id}}" data-parent-id="-1">{{category.name}}</a>
                <ul>
                    {% for subcategory in category.get_children %}
                    <li>
                        <a class="category" data-category-id="{{subcategory.id}}"
                            data-parent-id="{{subcategory.parent_category.id}}">{{subcategory.name}}</a>
                        <ul>
                            {% for subsubcategory in subcategory.get_children %}
                            <li><a class="category" data-category-id="{{subsubcategory.id}}"
                                    data-parent-id="{{subsubcategory.parent_category.id}}">{{subsubcategory.name}}</a>
                            </li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% endfor %}
                </ul>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% include 'bootstrap/forms/category_edit_form.html' %}
<script>
    $(".category").on("click", function () {
        console.log($(this).data("category-id"))
        modal = $("#changeNameModal")
        form = modal.find("form")
        form.attr("action", "update/" + $(this).data("category-id") + "/")
        form.find('select option[value="' + $(this).data("parent-id") + '"]').prop("selected", true)
        form.find("#name").val($(this).text())
        // replaces the hx-delete url for the delete button in the modal
        modal.find(".btn-danger").attr("hx-delete", "delete/" + $(this).data("category-id") + "/")
        // allow htmx to process the page again
        htmx.process(document.body)
        $("#changeNameModal").modal("show")
    })
</script>
{% endblock %}